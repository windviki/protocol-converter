
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>协议转换器</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .converter-section { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, textarea, button { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        textarea { height: 150px; font-family: monospace; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #e8f5e8; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .error { background: #ffe8e8; color: #d00; }
        .protocols-section { margin-top: 30px; }
        .protocol-family { margin-bottom: 20px; }
        .protocol-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .protocol-item { background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 4px; text-decoration: none; color: #333; }
        .protocol-item:hover { background: #f0f0f0; }
        pre { background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>协议转换器</h1>
            <p>基于Jinja2模板的通用协议转换系统</p>
        </div>
        
        <div class="converter-section">
            <h2>协议转换</h2>
            <div class="form-group">
                <label for="source_protocol">源协议族:</label>
                <select id="source_protocol">
                    {% for family in families %}
                    <option value="{{ family }}">{{ family }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="target_protocol">目标协议族:</label>
                <select id="target_protocol">
                    {% for family in families %}
                    <option value="{{ family }}">{{ family }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="input_json">输入JSON:</label>
                <textarea id="input_json" placeholder='{"domain": "telephone", "action": "DIAL", "slots": {"category": "手机", "name": "张三", "raw_name": "张三"}}'></textarea>
            </div>
            
            <button onclick="convertProtocol()">转换协议</button>
            
            <div id="result" style="display: none;"></div>
        </div>
        
        <div class="protocols-section">
            <h2>协议列表</h2>
            {% for family in families %}
            <div class="protocol-family">
                <h3>{{ family }} 协议族</h3>
                <div class="protocol-list">
                    {% for protocol in protocols_info[family] %}
                    <a href="/protocols/{{ protocol }}" class="protocol-item">{{ protocol }}</a>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <script>
        function convertProtocol() {
            const sourceProtocol = document.getElementById('source_protocol').value;
            const targetProtocol = document.getElementById('target_protocol').value;
            const inputJson = document.getElementById('input_json').value;
            const resultDiv = document.getElementById('result');
            
            if (!inputJson.trim()) {
                alert('请输入JSON数据');
                return;
            }
            
            fetch('/convert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    source_protocol: sourceProtocol,
                    target_protocol: targetProtocol,
                    input_json: inputJson
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = `
                        <h3>转换成功</h3>
                        <p><strong>匹配协议:</strong> ${data.matched_protocol}</p>
                        <p><strong>提取变量:</strong> ${JSON.stringify(data.variables, null, 2)}</p>
                        <p><strong>转换结果:</strong></p>
                        <pre>${JSON.stringify(data.result, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h3>转换失败</h3><p>${data.error}</p>`;
                }
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h3>请求失败</h3><p>${error}</p>`;
                resultDiv.style.display = 'block';
            });
        }
    </script>
</body>
</html>
    